<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0">
  <meta name="theme-color" content="#4ADE80">
  <meta name="mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="default">
  <meta name="apple-mobile-web-app-title" content="SpanishSpark">
  <title>SpanishSpark ğŸ‡ªğŸ‡¸</title>
  <link href="https://fonts.googleapis.com/css2?family=Baloo+2:wght@600;800&family=Nunito:wght@400;600;700&display=swap" rel="stylesheet">
  <style>
    /* â”€â”€ RESET & BASE â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    *, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }

    :root {
      --primary:      #4ADE80;
      --primary-dark: #22C55E;
      --accent:       #FBBF24;
      --pop:          #F472B6;
      --blue:         #60A5FA;
      --bg:           #F0FDF4;
      --card:         #FFFFFF;
      --text:         #1E293B;
      --text-light:   #64748B;
      --radius-card:  20px;
      --radius-btn:   999px;
      --shadow:       0 4px 20px rgba(0,0,0,0.08);
    }

    body {
      font-family: 'Nunito', sans-serif;
      background: var(--bg);
      color: var(--text);
      min-height: 100vh;
      overflow-x: hidden;
      transition: background 0.3s, color 0.3s;
    }

    /* â”€â”€ DARK MODE â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    body.dark-mode {
      --bg:         #0F172A;
      --card:       #1E293B;
      --text:       #F1F5F9;
      --text-light: #94A3B8;
    }
    body.dark-mode .progress-bar { background: #334155; }
    body.dark-mode .word-card { background: var(--card); }
    body.dark-mode .quiz-option { background: var(--card); border-color: #334155; color: var(--text); }
    body.dark-mode .support-banner { background: #1E293B; border-color: var(--accent); }
    body.dark-mode .nav-bar { background: var(--card); border-top-color: #334155; }
    body.dark-mode .science-card { background: var(--card); }
    body.dark-mode input[type="text"] { background: #0F172A; border-color: #334155; color: var(--text); }
    body.dark-mode .toggle-slider { background: #334155; }

    /* â”€â”€ LAYOUT â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    .screen {
      display: none;
      max-width: 420px;
      margin: 0 auto;
      padding: 20px 16px 90px;
      min-height: 100vh;
      position: relative;
    }
    .screen.active { display: block; }

    /* â”€â”€ DECORATIVE BLOBS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    .blob {
      position: fixed; border-radius: 60% 40% 70% 30% / 50% 60% 40% 50%;
      opacity: 0.12; pointer-events: none; z-index: 0;
    }
    .blob-1 { width: 300px; height: 300px; background: var(--primary); top: -80px; right: -80px; }
    .blob-2 { width: 200px; height: 200px; background: var(--pop); bottom: 100px; left: -60px; }
    .screen > * { position: relative; z-index: 1; }

    /* â”€â”€ TYPOGRAPHY â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    h1, h2, h3 { font-family: 'Baloo 2', cursive; }
    h1 { font-size: 1.8rem; font-weight: 800; }
    h2 { font-size: 1.4rem; font-weight: 700; }
    h3 { font-size: 1.1rem; font-weight: 600; }

    /* â”€â”€ CARD â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    .card {
      background: var(--card);
      border-radius: var(--radius-card);
      box-shadow: var(--shadow);
      padding: 18px 20px;
      margin-bottom: 14px;
    }

    /* â”€â”€ BUTTONS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    .btn-primary {
      background: var(--primary); color: #fff; border: none;
      border-radius: var(--radius-btn); padding: 14px 32px;
      font-family: 'Nunito', sans-serif; font-size: 1rem; font-weight: 700;
      cursor: pointer; min-height: 48px; width: 100%;
      transition: transform 0.1s, background 0.2s;
      display: block;
    }
    .btn-primary:active { transform: scale(0.96); }
    .btn-primary:disabled { background: #A7F3D0; cursor: not-allowed; }

    .btn-secondary {
      background: transparent; color: var(--text); border: 2px solid #E2E8F0;
      border-radius: var(--radius-btn); padding: 12px 24px;
      font-family: 'Nunito', sans-serif; font-size: 0.95rem; font-weight: 700;
      cursor: pointer; min-height: 48px;
      transition: transform 0.1s;
    }
    .btn-secondary:active { transform: scale(0.96); }

    .btn-coffee {
      display: inline-block; text-align: center;
      background: var(--accent); color: #1E293B;
      border: none; border-radius: var(--radius-btn);
      padding: 12px 22px; font-family: 'Nunito', sans-serif;
      font-weight: 700; font-size: 0.9rem;
      cursor: pointer; text-decoration: none;
      min-height: 48px; line-height: 1.6;
      transition: transform 0.1s;
    }
    .btn-coffee:active { transform: scale(0.97); }

    .btn-dismiss {
      background: none; border: none; color: var(--text-light);
      font-size: 1.2rem; cursor: pointer;
      padding: 4px 6px; flex-shrink: 0; line-height: 1;
      min-height: 48px; display: flex; align-items: center;
    }

    /* â”€â”€ PROGRESS BAR â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    .progress-bar  { height: 12px; background: #E2E8F0; border-radius: 999px; overflow: hidden; margin-bottom: 6px; }
    .progress-fill {
      height: 100%;
      background: linear-gradient(90deg, var(--primary), var(--accent));
      border-radius: 999px;
      transition: width 0.4s ease;
    }

    /* â”€â”€ BADGE CHIPS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    .badge {
      display: inline-block;
      background: #F0FDF4; border: 1px solid var(--primary);
      color: var(--text); border-radius: 999px;
      padding: 4px 12px; font-size: 0.75rem; font-weight: 600;
      margin: 3px 2px;
    }
    body.dark-mode .badge { background: #1E293B; border-color: var(--primary); }

    /* â”€â”€ STREAK â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    .streak-bar {
      display: flex; align-items: center; gap: 10px;
      background: linear-gradient(135deg, #FEF3C7, #FFF7ED);
      border-radius: var(--radius-card); padding: 14px 18px;
      margin-bottom: 14px; box-shadow: var(--shadow);
    }
    .streak-num { font-family: 'Baloo 2', cursive; font-size: 2rem; font-weight: 800; color: #F59E0B; }
    .streak-label { font-size: 0.82rem; color: var(--text-light); }
    body.dark-mode .streak-bar { background: linear-gradient(135deg, #1E293B, #0F172A); }

    /* â”€â”€ WORD CARD â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    .word-card {
      background: var(--card);
      border-radius: var(--radius-card);
      box-shadow: var(--shadow);
      padding: 32px 24px;
      text-align: center;
      margin-bottom: 16px;
      position: relative;
      min-height: 180px;
      display: flex; flex-direction: column; align-items: center; justify-content: center;
    }
    .word-es {
      font-family: 'Baloo 2', cursive;
      font-size: 2.4rem; font-weight: 800;
      color: var(--text); margin-bottom: 8px;
      line-height: 1.1;
    }
    .word-en {
      font-size: 1rem; color: var(--text-light); font-weight: 600;
    }
    .word-cat {
      font-size: 0.75rem; background: var(--primary);
      color: #fff; border-radius: 999px; padding: 3px 12px;
      position: absolute; top: 14px; left: 14px; font-weight: 700;
    }
    .speak-btn {
      position: absolute; top: 12px; right: 12px;
      background: var(--bg); border: none; border-radius: 50%;
      width: 44px; height: 44px; font-size: 1.3rem;
      cursor: pointer; display: flex; align-items: center; justify-content: center;
      transition: transform 0.1s;
    }
    .speak-btn:active { transform: scale(0.9); }

    /* â”€â”€ CARD NAV â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    .card-nav {
      display: flex; gap: 10px; margin-bottom: 14px;
    }
    .card-nav button { flex: 1; }

    /* â”€â”€ QUIZ OPTIONS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    .quiz-question-text {
      font-family: 'Baloo 2', cursive;
      font-size: 1.5rem; font-weight: 700;
      text-align: center; margin: 16px 0 20px;
    }
    .quiz-option {
      display: block; width: 100%;
      background: var(--card); border: 2px solid #E2E8F0;
      border-radius: var(--radius-card); padding: 14px 20px;
      font-family: 'Nunito', sans-serif; font-size: 1rem; font-weight: 600;
      cursor: pointer; margin-bottom: 10px; text-align: left;
      transition: border-color 0.15s, background 0.15s, transform 0.1s;
      color: var(--text);
    }
    .quiz-option:active { transform: scale(0.98); }
    .quiz-option.correct { border-color: var(--primary); background: #F0FDF4; color: #166534; }
    .quiz-option.wrong   { border-color: #F87171; background: #FFF1F2; color: #991B1B; }
    .quiz-option.shake   { animation: shake 0.35s ease; }
    .quiz-option:disabled { cursor: default; }

    @keyframes shake {
      0%,100% { transform: translateX(0); }
      20%      { transform: translateX(-6px); }
      40%      { transform: translateX(6px); }
      60%      { transform: translateX(-4px); }
      80%      { transform: translateX(4px); }
    }

    /* â”€â”€ SCIENCE CARD â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    .science-card {
      background: var(--card); border-radius: var(--radius-card);
      box-shadow: var(--shadow); margin-bottom: 14px; overflow: hidden;
    }
    .science-header {
      padding: 14px 18px; cursor: pointer;
      display: flex; align-items: center; justify-content: space-between;
      font-family: 'Baloo 2', cursive; font-size: 1rem; font-weight: 700;
      user-select: none;
    }
    .science-body { padding: 0 18px 14px; display: none; }
    .science-body.open { display: block; }

    /* â”€â”€ B1 TOPIC CARDS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    .b1-topic-btn {
      display: block; width: 100%;
      background: var(--card); border: none; border-radius: var(--radius-card);
      box-shadow: var(--shadow); padding: 16px 20px;
      font-family: 'Nunito', sans-serif; font-size: 1rem; font-weight: 700;
      cursor: pointer; text-align: left; margin-bottom: 10px;
      color: var(--text); transition: transform 0.1s;
      display: flex; align-items: center; gap: 12px;
    }
    .b1-topic-btn:active { transform: scale(0.98); }
    .b1-topic-icon { font-size: 1.5rem; flex-shrink: 0; }

    /* â”€â”€ B1 GRAMMAR DETAIL â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    .example-row {
      background: var(--bg); border-radius: 12px; padding: 12px 14px;
      margin-bottom: 8px; display: flex; align-items: flex-start; gap: 10px;
    }
    body.dark-mode .example-row { background: #0F172A; }
    .example-text { flex: 1; }
    .example-es { font-weight: 700; font-size: 1rem; color: var(--text); }
    .example-en { font-size: 0.85rem; color: var(--text-light); margin-top: 2px; }

    /* â”€â”€ SUPPORT BANNER â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    .support-banner {
      display: flex; align-items: flex-start; gap: 12px;
      background: #FFF7ED; border: 2px solid var(--accent);
      border-radius: var(--radius-card);
      padding: 14px; margin-bottom: 14px;
    }

    /* â”€â”€ RESULT SCREEN â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    .score-circle {
      width: 120px; height: 120px;
      border-radius: 50%;
      background: linear-gradient(135deg, var(--primary), var(--primary-dark));
      display: flex; flex-direction: column; align-items: center; justify-content: center;
      margin: 0 auto 20px; box-shadow: 0 8px 24px rgba(74,222,128,0.35);
    }
    .score-num { font-family: 'Baloo 2', cursive; font-size: 2.4rem; font-weight: 800; color: #fff; line-height: 1; }
    .score-denom { font-size: 0.85rem; color: rgba(255,255,255,0.8); font-weight: 600; }

    .tip-card {
      background: #EFF6FF; border-radius: var(--radius-card);
      padding: 16px 18px; margin-bottom: 14px; font-size: 0.88rem; line-height: 1.6;
      color: var(--text);
    }
    body.dark-mode .tip-card { background: #1E3A5F; }
    .tip-card small { color: var(--text-light); display: block; margin-top: 4px; }

    /* â”€â”€ TOGGLE SWITCH â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    .toggle-wrap { position: relative; display: inline-block; width: 50px; height: 28px; }
    .toggle-wrap input { opacity: 0; width: 0; height: 0; }
    .toggle-slider {
      position: absolute; cursor: pointer; inset: 0;
      background: #E2E8F0; border-radius: 999px;
      transition: background 0.3s;
    }
    .toggle-slider::before {
      content: ''; position: absolute;
      width: 20px; height: 20px; border-radius: 50%;
      background: #fff; top: 4px; left: 4px;
      transition: transform 0.3s;
      box-shadow: 0 2px 6px rgba(0,0,0,0.15);
    }
    .toggle-wrap input:checked + .toggle-slider { background: var(--primary); }
    .toggle-wrap input:checked + .toggle-slider::before { transform: translateX(22px); }

    /* â”€â”€ BOTTOM NAV â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    .nav-bar {
      position: fixed; bottom: 0; left: 0; right: 0;
      background: var(--card);
      border-top: 1px solid #E2E8F0;
      display: flex; z-index: 100;
      box-shadow: 0 -4px 16px rgba(0,0,0,0.06);
    }
    .nav-item {
      flex: 1; display: flex; flex-direction: column; align-items: center; justify-content: center;
      padding: 10px 4px 8px; cursor: pointer; border: none; background: none;
      font-family: 'Nunito', sans-serif; font-size: 0.7rem; font-weight: 700;
      color: var(--text-light); gap: 3px; min-height: 56px;
      transition: color 0.15s;
    }
    .nav-item .nav-icon { font-size: 1.4rem; line-height: 1; }
    .nav-item.active { color: var(--primary-dark); }

    /* â”€â”€ TOAST â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    #toast {
      position: fixed; bottom: 80px; left: 50%; transform: translateX(-50%);
      background: #1E293B; color: #fff; padding: 10px 22px;
      border-radius: 999px; font-size: 0.9rem; font-weight: 600;
      opacity: 0; pointer-events: none; transition: opacity 0.25s;
      z-index: 999; white-space: nowrap;
    }
    #toast.show { opacity: 1; }

    /* â”€â”€ UTILITY â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    .mt8  { margin-top: 8px; }
    .mt14 { margin-top: 14px; }
    .mb8  { margin-bottom: 8px; }
    .text-center { text-align: center; }
    .flex-between { display: flex; align-items: center; justify-content: space-between; }
    .phrase-es { font-family: 'Baloo 2', cursive; font-size: 1.1rem; font-weight: 700; color: var(--text); }
    .phrase-en { font-size: 0.85rem; color: var(--text-light); margin-top: 4px; }
    .screen-title { font-family: 'Baloo 2', cursive; font-size: 1.6rem; font-weight: 800; margin-bottom: 16px; }
    .back-btn {
      background: none; border: none; font-size: 1.4rem; cursor: pointer;
      color: var(--text-light); padding: 4px 8px 4px 0; min-height: 48px;
    }
  </style>
</head>
<body>

<!-- â”€â”€ DECORATIVE BLOBS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ -->
<div class="blob blob-1"></div>
<div class="blob blob-2"></div>

<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
     SCREEN: HOME
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<section id="screen-home" class="screen active">
  <div style="display:flex; align-items:center; justify-content:space-between; margin-bottom:18px;">
    <h1>SpanishSpark <span style="font-size:1.2rem;">ğŸ‡ªğŸ‡¸</span></h1>
  </div>

  <!-- Streak bar -->
  <div class="streak-bar">
    <div class="streak-num" id="home-streak">1</div>
    <div>
      <div style="font-weight:700;">ğŸ”¥ Day Streak</div>
      <div class="streak-label">ğŸ“… Daily micro-sessions beat cramming â€” Distributed Practice Theory</div>
    </div>
  </div>

  <!-- Phrase of the Day -->
  <div class="card">
    <div style="font-size:0.75rem; font-weight:700; color:var(--primary-dark); margin-bottom:8px; text-transform:uppercase; letter-spacing:0.05em;">Phrase of the Day</div>
    <div class="phrase-es" id="phrase-es">Loadingâ€¦</div>
    <div class="phrase-en" id="phrase-en"></div>
    <button class="speak-btn" style="position:static; margin-top:10px;" id="phrase-speak-btn" aria-label="Speak phrase">ğŸ”Š</button>
    <div class="badge" style="margin-top:8px;">ğŸ“– Built on SLA Input Hypothesis â€” Krashen, 1982</div>
  </div>

  <!-- Buy Me a Coffee banner -->
  <div class="support-banner" id="support-banner">
    <span style="font-size:1.5rem; flex-shrink:0; padding-top:2px;">â˜•</span>
    <div style="flex:1;">
      <strong style="font-size:0.95rem;">SpanishSpark is free â€” always.</strong><br>
      <span style="font-size:0.82rem; color:var(--text-light);">
        If it has helped you learn, consider supporting on Buy Me a Coffee. It means a lot!
      </span>
      <div style="margin-top:8px;">
        <a href="https://buymeacoffee.com/YOUR_USERNAME" target="_blank" rel="noopener"
           class="btn-coffee" style="font-size:0.85rem; padding:8px 18px; min-height:40px; line-height:1.4;">â˜• Buy me a coffee</a>
      </div>
    </div>
    <button class="btn-dismiss" onclick="dismissSupportBanner()" aria-label="Dismiss">âœ•</button>
  </div>

  <!-- Science card (collapsible) -->
  <div class="science-card">
    <div class="science-header" onclick="toggleScience()">
      <span>ğŸ”¬ Science Behind This</span>
      <span id="science-arrow">â–¼</span>
    </div>
    <div class="science-body" id="science-body">
      <div class="badge">ğŸ§  Spaced repetition boosts recall 200% â€” Ebbinghaus, 1885</div>
      <div class="badge">ğŸ“– Built on SLA Input Hypothesis â€” Krashen, 1982</div>
      <div class="badge">âš¡ Chunking cuts cognitive load â€” Miller's Law, 1956</div>
      <div class="badge">ğŸ“… Daily micro-sessions beat cramming â€” Distributed Practice Theory</div>
      <div class="badge">ğŸ“ B1 content follows CEFR framework</div>
    </div>
  </div>

  <!-- Start Lesson button -->
  <button class="btn-primary" onclick="showScreen('screen-lesson'); loadLesson(loadData('currentDay',0));" style="margin-top:4px;">
    ğŸ“š Start Today's Lesson
  </button>
</section>

<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
     SCREEN: LESSON
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<section id="screen-lesson" class="screen">
  <div style="display:flex; align-items:center; gap:8px; margin-bottom:14px;">
    <button class="back-btn" onclick="showScreen('screen-home')">â†</button>
    <h2 style="flex:1;">Today's Words</h2>
    <span id="lesson-counter" style="font-size:0.85rem; color:var(--text-light); font-weight:700;"></span>
  </div>

  <!-- Progress bar -->
  <div class="progress-bar" style="margin-bottom:4px;">
    <div class="progress-fill" id="lesson-progress-fill" style="width:0%"></div>
  </div>
  <div class="badge" style="margin-bottom:14px;">ğŸ§  Spaced repetition boosts recall 200% â€” Ebbinghaus, 1885</div>

  <!-- Word card -->
  <div class="word-card" id="word-card">
    <span class="word-cat" id="word-cat">â€”</span>
    <button class="speak-btn" id="word-speak-btn" aria-label="Speak word">ğŸ”Š</button>
    <div class="word-es" id="word-es">â€”</div>
    <div class="word-en" id="word-en">â€”</div>
  </div>

  <!-- Card nav -->
  <div class="card-nav">
    <button class="btn-secondary" onclick="prevCard()">â† Prev</button>
    <button class="btn-secondary" onclick="nextCard()">Next â†’</button>
  </div>

  <!-- Take Quiz -->
  <button class="btn-primary" id="take-quiz-btn" onclick="startQuiz()" style="margin-top:6px;">
    ğŸ¯ Take Quiz
  </button>
</section>

<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
     SCREEN: QUIZ
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<section id="screen-quiz" class="screen">
  <div style="display:flex; align-items:center; gap:8px; margin-bottom:14px;">
    <button class="back-btn" onclick="showScreen('screen-lesson')">â†</button>
    <h2 style="flex:1;">Quiz Time ğŸ¯</h2>
    <span id="quiz-counter" style="font-size:0.85rem; color:var(--text-light); font-weight:700;"></span>
  </div>

  <div class="progress-bar" style="margin-bottom:16px;">
    <div class="progress-fill" id="quiz-progress-fill" style="width:0%"></div>
  </div>

  <div class="quiz-question-text" id="quiz-question">â€”</div>
  <div id="quiz-options"></div>
  <div id="quiz-feedback" style="text-align:center; font-weight:700; font-size:1rem; min-height:28px; margin-top:4px;"></div>
</section>

<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
     SCREEN: RESULT
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<section id="screen-result" class="screen text-center">
  <h2 style="margin-bottom:20px;">Â¡Bien hecho! ğŸ‰</h2>

  <div class="score-circle">
    <div class="score-num" id="result-score">0</div>
    <div class="score-denom" id="result-total">/ 5</div>
  </div>

  <div class="card" style="margin-bottom:14px;">
    <div style="font-size:1.3rem; margin-bottom:4px;">ğŸ”¥ <strong id="result-streak">1</strong> day streak!</div>
    <div style="font-size:0.85rem; color:var(--text-light);">Keep it up â€” come back tomorrow!</div>
  </div>

  <div class="tip-card">
    ğŸ’¡ <strong>Study faster next time!</strong><br>
    Add SpanishSpark to your home screen.
    <small>ğŸ“± Android: Chrome â†’ â‹® â†’ "Add to Home Screen"</small>
    <small>ğŸ iPhone: Safari â†’ Share â†’ "Add to Home Screen"</small>
  </div>

  <button class="btn-primary" onclick="showScreen('screen-home')">ğŸ  Back to Home</button>
</section>

<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
     SCREEN: B1
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<section id="screen-b1" class="screen">
  <!-- Topic list -->
  <div id="b1-topic-list">
    <div style="margin-bottom:16px;">
      <h2 class="screen-title">B1 Grammar ğŸ“</h2>
      <div class="badge">ğŸ“ B1 content follows CEFR framework</div>
    </div>
    <div id="b1-buttons"></div>
  </div>

  <!-- Topic detail (hidden until topic selected) -->
  <div id="b1-detail" style="display:none;">
    <div style="display:flex; align-items:center; gap:8px; margin-bottom:14px;">
      <button class="back-btn" onclick="showB1List()">â†</button>
      <h2 style="flex:1;" id="b1-detail-title"></h2>
    </div>

    <div class="card">
      <div style="font-size:0.75rem; font-weight:700; color:var(--primary-dark); margin-bottom:8px; text-transform:uppercase; letter-spacing:0.05em;">Explanation</div>
      <div id="b1-explanation" style="font-size:0.95rem; line-height:1.6;"></div>
    </div>

    <div id="b1-examples" style="margin-bottom:14px;"></div>

    <!-- B1 mini quiz -->
    <div class="card" id="b1-quiz-card">
      <div style="font-size:0.75rem; font-weight:700; color:var(--primary-dark); margin-bottom:12px; text-transform:uppercase; letter-spacing:0.05em;">Mini Quiz</div>
      <div id="b1-quiz-content"></div>
    </div>
  </div>
</section>

<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
     SCREEN: SETTINGS
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<section id="screen-settings" class="screen">
  <h2 class="screen-title">Settings âš™ï¸</h2>

  <!-- Quiz direction -->
  <div class="card flex-between">
    <div>
      <strong>Quiz Direction</strong>
      <div style="font-size:0.82rem; color:var(--text-light); margin-top:2px;" id="direction-label">Spanish â†’ English</div>
    </div>
    <label class="toggle-wrap">
      <input type="checkbox" id="direction-toggle" onchange="toggleDirection(this.checked)">
      <span class="toggle-slider"></span>
    </label>
  </div>

  <!-- Dark mode -->
  <div class="card flex-between">
    <div>
      <strong>ğŸŒ™ Dark Mode</strong>
      <div style="font-size:0.82rem; color:var(--text-light); margin-top:2px;">Easier on your eyes at night</div>
    </div>
    <label class="toggle-wrap">
      <input type="checkbox" id="dark-mode-toggle" onchange="toggleDarkMode(this.checked)">
      <span class="toggle-slider"></span>
    </label>
  </div>

  <!-- Longest streak -->
  <div class="card text-center" style="padding:20px;">
    <div style="font-size:2.4rem; font-family:'Baloo 2',cursive; font-weight:800; color:#F59E0B;" id="settings-longest">1</div>
    <div style="font-weight:700; margin-bottom:2px;">ğŸ† Longest Streak</div>
    <div style="font-size:0.82rem; color:var(--text-light);">Your personal best</div>
  </div>

  <!-- Score graph -->
  <div class="card">
    <strong>ğŸ“Š Your Quiz History</strong>
    <div style="font-size:0.82rem; color:var(--text-light); margin:4px 0 12px;">Last 10 sessions</div>
    <canvas id="score-canvas" style="width:100%; display:block;"></canvas>
    <p id="score-graph-empty" style="font-size:0.85rem; color:var(--text-light); text-align:center; padding:10px 0; display:none;">
      No quiz scores yet â€” complete your first quiz!
    </p>
  </div>

  <!-- Buy Me a Coffee -->
  <div class="card text-center" style="padding:24px 20px;">
    <div style="font-size:2rem; margin-bottom:6px;">â˜•</div>
    <strong style="font-size:1.05rem;">Support SpanishSpark</strong>
    <p style="font-size:0.88rem; color:var(--text-light); margin:8px 0 14px; line-height:1.5;">
      This app is free, with no ads and no data collection.<br>If it has been useful, a small donation helps keep it going.
    </p>
    <a href="https://buymeacoffee.com/YOUR_USERNAME" target="_blank" rel="noopener"
       class="btn-coffee">â˜• Buy me a coffee</a>
  </div>
</section>

<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
     BOTTOM NAV
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<nav class="nav-bar">
  <button class="nav-item active" id="nav-home" onclick="showScreen('screen-home')">
    <span class="nav-icon">ğŸ </span>Home
  </button>
  <button class="nav-item" id="nav-lesson" onclick="showScreen('screen-lesson'); loadLesson(loadData('currentDay',0));">
    <span class="nav-icon">ğŸ“š</span>Lesson
  </button>
  <button class="nav-item" id="nav-b1" onclick="showScreen('screen-b1')">
    <span class="nav-icon">ğŸ“</span>B1
  </button>
  <button class="nav-item" id="nav-settings" onclick="showScreen('screen-settings'); initSettingsScreen();">
    <span class="nav-icon">âš™ï¸</span>Settings
  </button>
</nav>

<!-- Toast -->
<div id="toast"></div>

<script>
/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   DATA
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
const lessonBank = [
  // SURVIVAL
  { es:'Hola',          en:'Hello',            cat:'Survival' },
  { es:'AdiÃ³s',         en:'Goodbye',          cat:'Survival' },
  { es:'Por favor',     en:'Please',           cat:'Survival' },
  { es:'Gracias',       en:'Thank you',        cat:'Survival' },
  { es:'De nada',       en:"You're welcome",   cat:'Survival' },
  { es:'Lo siento',     en:"I'm sorry",        cat:'Survival' },
  { es:'PerdÃ³n',        en:'Excuse me',        cat:'Survival' },
  { es:'Buenos dÃ­as',   en:'Good morning',     cat:'Survival' },
  { es:'Buenas tardes', en:'Good afternoon',   cat:'Survival' },
  { es:'Buenas noches', en:'Good night',       cat:'Survival' },
  // PRONOUNS
  { es:'Yo',       en:'I',               cat:'Pronoun' },
  { es:'TÃº',       en:'You',             cat:'Pronoun' },
  { es:'Ã‰l',       en:'He',              cat:'Pronoun' },
  { es:'Ella',     en:'She',             cat:'Pronoun' },
  { es:'Nosotros', en:'We',              cat:'Pronoun' },
  { es:'Vosotros', en:'You all (Spain)', cat:'Pronoun' },
  { es:'Ellos',    en:'They',            cat:'Pronoun' },
  { es:'Usted',    en:'You (formal)',    cat:'Pronoun' },
  // NOUNS
  { es:'Casa',      en:'House',        cat:'Noun' },
  { es:'Escuela',   en:'School',       cat:'Noun' },
  { es:'Comida',    en:'Food',         cat:'Noun' },
  { es:'Amigo',     en:'Friend',       cat:'Noun' },
  { es:'Familia',   en:'Family',       cat:'Noun' },
  { es:'Coche',     en:'Car',          cat:'Noun' },
  { es:'Ciudad',    en:'City',         cat:'Noun' },
  { es:'PaÃ­s',      en:'Country',      cat:'Noun' },
  { es:'Libro',     en:'Book',         cat:'Noun' },
  { es:'TelÃ©fono',  en:'Phone',        cat:'Noun' },
  { es:'Dinero',    en:'Money',        cat:'Noun' },
  { es:'Agua',      en:'Water',        cat:'Noun' },
  { es:'Trabajo',   en:'Work / Job',   cat:'Noun' },
  { es:'Tiempo',    en:'Time/Weather', cat:'Noun' },
  { es:'Nombre',    en:'Name',         cat:'Noun' },
  // CONNECTORS
  { es:'Y',           en:'And',       cat:'Connector' },
  { es:'Pero',        en:'But',       cat:'Connector' },
  { es:'Porque',      en:'Because',   cat:'Connector' },
  { es:'Entonces',    en:'So / Then', cat:'Connector' },
  { es:'TambiÃ©n',     en:'Also',      cat:'Connector' },
  { es:'Sin embargo', en:'However',   cat:'Connector' },
  { es:'Aunque',      en:'Although',  cat:'Connector' },
  { es:'Si',          en:'If',        cat:'Connector' },
  // CHUNKS
  { es:'Â¿CÃ³mo estÃ¡s?',             en:'How are you?',         cat:'Chunk' },
  { es:'Mucho gusto',              en:'Nice to meet you',     cat:'Chunk' },
  { es:'Me gusta...',              en:'I like...',            cat:'Chunk' },
  { es:'Yo soy...',                en:'I am...',              cat:'Chunk' },
  { es:'Tengo...',                 en:'I have...',            cat:'Chunk' },
  { es:'Me llamo...',              en:'My name is...',        cat:'Chunk' },
  { es:'Â¿Puedes ayudarme?',        en:'Can you help me?',     cat:'Chunk' },
  { es:'No entiendo',              en:"I don't understand",   cat:'Chunk' },
  { es:'Â¿CÃ³mo se dice...?',        en:'How do you say...?',   cat:'Chunk' },
  { es:'Estoy aprendiendo espaÃ±ol',en:'I am learning Spanish',cat:'Chunk' },
  // QUESTIONS
  { es:'Â¿QuÃ©?',           en:'What?',                  cat:'Question' },
  { es:'Â¿QuiÃ©n?',         en:'Who?',                   cat:'Question' },
  { es:'Â¿DÃ³nde?',         en:'Where?',                 cat:'Question' },
  { es:'Â¿CuÃ¡ndo?',        en:'When?',                  cat:'Question' },
  { es:'Â¿Por quÃ©?',       en:'Why?',                   cat:'Question' },
  { es:'Â¿CÃ³mo?',          en:'How?',                   cat:'Question' },
  { es:'Â¿CuÃ¡nto cuesta?', en:'How much does it cost?', cat:'Question' },
  { es:'Â¿Hablas inglÃ©s?', en:'Do you speak English?',  cat:'Question' },
  { es:'Â¿A quÃ© hora?',    en:'At what time?',          cat:'Question' },
  // GREETINGS & COMPLIMENTS
  { es:'Hasta luego',    en:'See you later',    cat:'Greeting' },
  { es:'Hasta maÃ±ana',   en:'See you tomorrow', cat:'Greeting' },
  { es:'Â¡Buen trabajo!', en:'Good job!',        cat:'Compliment' },
  { es:'Â¡Excelente!',    en:'Excellent!',       cat:'Compliment' },
  { es:'Â¡Muy bien!',     en:'Very good!',       cat:'Compliment' },
  { es:'Â¡IncreÃ­ble!',    en:'Incredible!',      cat:'Compliment' },
];

const phraseOfTheDay = [
  { es:'El que no arriesga, no gana.',       en:'Nothing ventured, nothing gained.' },
  { es:'Poco a poco se llega lejos.',        en:'Little by little, you go far.' },
  { es:'La prÃ¡ctica hace al maestro.',       en:'Practice makes perfect.' },
  { es:'Querer es poder.',                   en:'Where there is a will, there is a way.' },
  { es:'Cada dÃ­a es una nueva oportunidad.', en:'Every day is a new opportunity.' },
  { es:'Hoy es un buen dÃ­a para aprender.',  en:'Today is a good day to learn.' },
  { es:'El conocimiento es poder.',          en:'Knowledge is power.' },
];

const b1Topics = [
  {
    id: 'ser-estar', title: 'Ser vs. Estar', icon: 'ğŸ”µ',
    explanation: 'Both mean "to be." SER = permanent (identity, origin, job). ESTAR = temporary (emotions, location, states).',
    examples: [
      { es:'Yo soy mÃ©dico.',       en:'I am a doctor. (SER â€” job)' },
      { es:'Yo estoy cansado.',    en:'I am tired. (ESTAR â€” feeling)' },
      { es:'Madrid es la capital.',en:'Madrid is the capital. (SER â€” permanent)' },
      { es:'Ella estÃ¡ en casa.',   en:'She is at home. (ESTAR â€” location)' },
    ],
    quiz: [
      { q:'I am a teacher.', fill:'Yo ___ profesor.', options:['soy','estoy','es','estÃ¡'], correct:0 },
      { q:'She is happy.',   fill:'Ella ___ feliz.',  options:['es','soy','estÃ¡','estÃ¡s'],  correct:2 },
    ]
  },
  {
    id: 'preterite-imperfect', title: 'Preterite vs. Imperfect', icon: 'â³',
    explanation: 'PRETERITE = completed past (specific time). IMPERFECT = habitual/ongoing past (used to, was doing).',
    examples: [
      { es:'Ayer comÃ­ pizza.',       en:'Yesterday I ate pizza. (Preterite)' },
      { es:'De niÃ±o comÃ­a mucho.',   en:'As a child I used to eat a lot. (Imperfect)' },
      { es:'Ella llegÃ³ a las 8.',    en:'She arrived at 8. (Preterite)' },
      { es:'Siempre llegaba tarde.', en:'She always arrived late. (Imperfect)' },
    ],
    quiz: [
      { q:'Yesterday I spoke Spanish.', fill:'Ayer ___ espaÃ±ol.', options:['hablaba','hablÃ©','habla','hablo'], correct:1 },
      { q:'I used to live in Madrid.',  fill:'___ en Madrid.',    options:['VivÃ­','Vivo','VivÃ­a','Vivimos'],   correct:2 },
    ]
  },
  {
    id: 'subjunctive', title: 'Subjunctive Mood', icon: 'ğŸ¤”',
    explanation: 'Used for wishes, doubt, or emotion. Triggered by: quiero queâ€¦, espero queâ€¦, es importante queâ€¦',
    examples: [
      { es:'Quiero que vengas.',           en:'I want you to come.' },
      { es:'Espero que estudies.',         en:'I hope you study.' },
      { es:'Es importante que practiques.',en:'It is important that you practice.' },
      { es:'OjalÃ¡ hable bien.',            en:'Hopefully I speak well.' },
    ],
    quiz: [
      { q:'I want you to eat.', fill:'Quiero que ___.', options:['comes','comas','comer','como'], correct:1 },
    ]
  },
  {
    id: 'object-pronouns', title: 'Object Pronouns', icon: 'ğŸ”—',
    explanation: 'Direct: lo, la, los, las (replace the thing). Indirect: le, les (replace the person).',
    examples: [
      { es:'Lo veo.',          en:'I see it/him.' },
      { es:'La llamo.',        en:'I call her.' },
      { es:'Le doy el libro.', en:'I give him/her the book.' },
      { es:'Les escribo.',     en:'I write to them.' },
    ],
    quiz: [
      { q:'I see her.', fill:'___ veo.', options:['Lo','La','Le','Les'], correct:1 },
    ]
  },
  {
    id: 'reflexive-verbs', title: 'Reflexive Verbs', icon: 'ğŸ”„',
    explanation: 'Subject acts on itself. Uses: me, te, se, nos, os, se before the verb.',
    examples: [
      { es:'Me llamo Ana.',               en:'My name is Ana.' },
      { es:'Me levanto a las 7.',         en:'I get up at 7.' },
      { es:'Ella se ducha por la maÃ±ana.',en:'She showers in the morning.' },
      { es:'Nos acostamos tarde.',        en:'We go to bed late.' },
    ],
    quiz: [
      { q:'I wash myself.', fill:'___ lavo.', options:['Te','Me','Se','Nos'], correct:1 },
    ]
  },
];

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   STORAGE
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function saveData(key, value) {
  try { localStorage.setItem(key, JSON.stringify(value)); }
  catch(e) { console.warn('Storage unavailable:', e); }
}
function loadData(key, fallback = null) {
  try {
    const item = localStorage.getItem(key);
    return item !== null ? JSON.parse(item) : fallback;
  } catch(e) { return fallback; }
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   TTS
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
let voices = [];
function loadVoices() { voices = window.speechSynthesis.getVoices(); }
loadVoices();
if (window.speechSynthesis.onvoiceschanged !== undefined) {
  window.speechSynthesis.onvoiceschanged = loadVoices;
}

function speakSpanish(text) {
  window.speechSynthesis.cancel();
  const utterance = new SpeechSynthesisUtterance(text);
  utterance.lang = 'es-ES';
  utterance.rate = 0.85;
  utterance.pitch = 1;
  const spanishVoice = voices.find(v => v.lang.startsWith('es'));
  if (spanishVoice) utterance.voice = spanishVoice;
  window.speechSynthesis.speak(utterance);
}

/* Speak buttons â€” must be direct click, never async (iOS rule) */
document.getElementById('phrase-speak-btn').addEventListener('click', function() {
  const text = document.getElementById('phrase-es').textContent;
  if (text) speakSpanish(text);
});

document.getElementById('word-speak-btn').addEventListener('click', function() {
  const text = document.getElementById('word-es').textContent;
  if (text && text !== 'â€”') speakSpanish(text);
});

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   SCREEN NAVIGATION
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
const navMap = {
  'screen-home':     'nav-home',
  'screen-lesson':   'nav-lesson',
  'screen-quiz':     'nav-lesson',
  'screen-result':   'nav-lesson',
  'screen-b1':       'nav-b1',
  'screen-settings': 'nav-settings',
};

function showScreen(id) {
  document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
  document.getElementById(id).classList.add('active');
  document.querySelectorAll('.nav-item').forEach(n => n.classList.remove('active'));
  const navId = navMap[id];
  if (navId) document.getElementById(navId).classList.add('active');
  window.scrollTo(0, 0);
  if (id === 'screen-home') { refreshHome(); }
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   STREAK
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function updateStreak() {
  const today    = new Date().toDateString();
  let streak     = loadData('streak', 1);
  let lastDate   = loadData('lastStudyDate', null);
  let longest    = loadData('longestStreak', 1);

  if (!lastDate) {
    streak = 1;
  } else if (lastDate === today) {
    return streak;
  } else {
    const diffDays = Math.round((new Date(today) - new Date(lastDate)) / 86400000);
    streak = diffDays === 1 ? streak + 1 : 1;
  }

  if (streak > longest) longest = streak;
  saveData('streak', streak);
  saveData('lastStudyDate', today);
  saveData('longestStreak', longest);
  return streak;
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   PHRASE OF THE DAY
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function getTodayPhrase() {
  const dayOfYear = Math.floor(
    (new Date() - new Date(new Date().getFullYear(), 0, 0)) / 86400000
  );
  return phraseOfTheDay[dayOfYear % phraseOfTheDay.length];
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   HOME SCREEN
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function refreshHome() {
  const streak = loadData('streak', 1);
  document.getElementById('home-streak').textContent = streak;
  const phrase = getTodayPhrase();
  document.getElementById('phrase-es').textContent = phrase.es;
  document.getElementById('phrase-en').textContent = phrase.en;
  initSupportBanner();
}

function toggleScience() {
  const body  = document.getElementById('science-body');
  const arrow = document.getElementById('science-arrow');
  const open  = body.classList.toggle('open');
  arrow.textContent = open ? 'â–²' : 'â–¼';
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   LESSON
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
let currentWords = [];
let currentCardIndex = 0;

function loadLesson(dayIndex) {
  const total = lessonBank.length;
  const start = (dayIndex * 7) % total;
  currentWords = [];
  for (let i = 0; i < 7; i++) {
    currentWords.push(lessonBank[(start + i) % total]);
  }
  currentCardIndex = 0;
  renderCard();
}

function renderCard() {
  const word = currentWords[currentCardIndex];
  document.getElementById('word-es').textContent = word.es;
  document.getElementById('word-en').textContent = word.en;
  document.getElementById('word-cat').textContent = word.cat;
  const total = currentWords.length;
  document.getElementById('lesson-counter').textContent = `${currentCardIndex + 1} / ${total}`;
  const pct = ((currentCardIndex + 1) / total) * 100;
  document.getElementById('lesson-progress-fill').style.width = pct + '%';
}

function nextCard() {
  if (currentCardIndex < currentWords.length - 1) {
    currentCardIndex++;
    renderCard();
  }
}

function prevCard() {
  if (currentCardIndex > 0) {
    currentCardIndex--;
    renderCard();
  }
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   QUIZ
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
let quizQuestions = [];
let quizIndex     = 0;
let quizScore     = 0;
let quizAnswered  = false;

function generateQuiz(dayWords, direction = 'ES_TO_EN', count = 5) {
  const pool = [...dayWords].sort(() => Math.random() - 0.5).slice(0, count);
  return pool.map(word => {
    const isES     = direction === 'ES_TO_EN';
    const question = isES ? word.es : word.en;
    const answer   = isES ? word.en : word.es;
    const wrong    = lessonBank
      .filter(w => w.es !== word.es)
      .sort(() => Math.random() - 0.5)
      .slice(0, 3)
      .map(w => isES ? w.en : w.es);
    const options = [...wrong, answer].sort(() => Math.random() - 0.5);
    return { question, answer, options };
  });
}

function startQuiz() {
  const dir    = loadData('quizDirection', 'ES_TO_EN');
  quizQuestions = generateQuiz(currentWords, dir, 5);
  quizIndex     = 0;
  quizScore     = 0;
  showScreen('screen-quiz');
  renderQuiz(quizQuestions);
}

function renderQuiz(questions) {
  renderQuizQuestion();
}

function renderQuizQuestion() {
  if (quizIndex >= quizQuestions.length) {
    showResult(quizScore, quizQuestions.length);
    return;
  }
  quizAnswered = false;
  const q   = quizQuestions[quizIndex];
  const pct = (quizIndex / quizQuestions.length) * 100;
  document.getElementById('quiz-progress-fill').style.width = pct + '%';
  document.getElementById('quiz-counter').textContent = `${quizIndex + 1} / ${quizQuestions.length}`;
  document.getElementById('quiz-question').textContent = q.question;
  document.getElementById('quiz-feedback').textContent = '';

  const optContainer = document.getElementById('quiz-options');
  optContainer.innerHTML = '';
  q.options.forEach(opt => {
    const btn = document.createElement('button');
    btn.className = 'quiz-option';
    btn.textContent = opt;
    btn.addEventListener('click', function() { checkAnswer(opt, q.answer, btn); });
    optContainer.appendChild(btn);
  });
}

function checkAnswer(selected, answer, btn) {
  if (quizAnswered) return;
  quizAnswered = true;

  const allBtns = document.querySelectorAll('.quiz-option');
  allBtns.forEach(b => b.disabled = true);

  if (selected === answer) {
    btn.classList.add('correct');
    document.getElementById('quiz-feedback').textContent = 'âœ… Correct!';
    quizScore++;
  } else {
    btn.classList.add('wrong');
    btn.classList.add('shake');
    document.getElementById('quiz-feedback').textContent = `âŒ Answer: ${answer}`;
    // highlight correct
    allBtns.forEach(b => { if (b.textContent === answer) b.classList.add('correct'); });
  }

  setTimeout(() => {
    quizIndex++;
    renderQuizQuestion();
  }, 1100);
}

function showResult(score, total) {
  const streak = updateStreak();
  const scores = loadData('quizScores', []);
  scores.push(score);
  saveData('quizScores', scores);

  // Advance day
  let day = loadData('currentDay', 0);
  day = (day + 1) % Math.ceil(lessonBank.length / 7);
  saveData('currentDay', day);
  const progress = loadData('lessonProgress', {});
  progress[day] = true;
  saveData('lessonProgress', progress);

  document.getElementById('result-score').textContent = score;
  document.getElementById('result-total').textContent  = '/ ' + total;
  document.getElementById('result-streak').textContent = streak;
  showScreen('screen-result');
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   B1 SCREEN
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function initB1Screen() {
  const container = document.getElementById('b1-buttons');
  container.innerHTML = '';
  const progress = loadData('b1Progress', {});
  b1Topics.forEach(topic => {
    const done = progress[topic.id];
    const btn  = document.createElement('button');
    btn.className = 'b1-topic-btn';
    btn.innerHTML = `
      <span class="b1-topic-icon">${topic.icon}</span>
      <div style="flex:1;">
        <div style="font-size:1rem;">${topic.title}</div>
        <div style="font-size:0.78rem; color:var(--text-light); margin-top:2px;">${done ? 'âœ… Completed' : 'Tap to study'}</div>
      </div>
      <span style="color:var(--text-light);">â€º</span>
    `;
    btn.addEventListener('click', () => loadB1Topic(topic.id));
    container.appendChild(btn);
  });
}

function loadB1Topic(topicId) {
  const topic = b1Topics.find(t => t.id === topicId);
  if (!topic) return;

  document.getElementById('b1-topic-list').style.display = 'none';
  document.getElementById('b1-detail').style.display     = 'block';
  document.getElementById('b1-detail-title').textContent = topic.icon + ' ' + topic.title;
  document.getElementById('b1-explanation').textContent  = topic.explanation;

  // Examples
  const exContainer = document.getElementById('b1-examples');
  exContainer.innerHTML = '';
  topic.examples.forEach(ex => {
    const row = document.createElement('div');
    row.className = 'example-row';
    row.innerHTML = `
      <div class="example-text">
        <div class="example-es">${ex.es}</div>
        <div class="example-en">${ex.en}</div>
      </div>
      <button class="speak-btn" style="position:static; flex-shrink:0;" data-text="${ex.es}" aria-label="Speak">ğŸ”Š</button>
    `;
    exContainer.appendChild(row);
  });

  // Attach speak buttons â€” direct click (iOS safe)
  exContainer.querySelectorAll('.speak-btn').forEach(btn => {
    btn.addEventListener('click', function() {
      speakSpanish(this.dataset.text);
    });
  });

  // B1 Mini Quiz
  renderB1Quiz(topic);
}

function renderB1Quiz(topic) {
  const container = document.getElementById('b1-quiz-content');
  container.innerHTML = '';
  let b1QuizIndex    = 0;
  let b1QuizScore    = 0;

  function showQ() {
    if (b1QuizIndex >= topic.quiz.length) {
      // Completed
      const progress = loadData('b1Progress', {});
      progress[topic.id] = true;
      saveData('b1Progress', progress);
      container.innerHTML = `<div style="text-align:center; padding:10px 0;">
        <div style="font-size:2rem;">ğŸ‰</div>
        <strong>Section complete!</strong>
        <div style="font-size:0.85rem; color:var(--text-light); margin-top:4px;">Score: ${b1QuizScore} / ${topic.quiz.length}</div>
      </div>`;
      return;
    }
    const q   = topic.quiz[b1QuizIndex];
    let answered = false;
    container.innerHTML = `
      <div style="font-size:0.9rem; color:var(--text-light); margin-bottom:6px;">${q.q}</div>
      <div style="font-family:'Baloo 2',cursive; font-size:1.15rem; font-weight:700; margin-bottom:14px;">${q.fill}</div>
      <div id="b1-opts"></div>
      <div id="b1-fb" style="font-weight:700; text-align:center; min-height:24px; margin-top:6px;"></div>
    `;
    const optsEl = document.getElementById('b1-opts');
    q.options.forEach((opt, idx) => {
      const btn = document.createElement('button');
      btn.className = 'quiz-option';
      btn.textContent = opt;
      btn.style.marginBottom = '8px';
      btn.addEventListener('click', function() {
        if (answered) return;
        answered = true;
        optsEl.querySelectorAll('button').forEach(b => b.disabled = true);
        if (idx === q.correct) {
          btn.classList.add('correct');
          document.getElementById('b1-fb').textContent = 'âœ… Correct!';
          b1QuizScore++;
        } else {
          btn.classList.add('wrong', 'shake');
          document.getElementById('b1-fb').textContent = `âŒ Answer: ${q.options[q.correct]}`;
          optsEl.querySelectorAll('button')[q.correct].classList.add('correct');
        }
        setTimeout(() => { b1QuizIndex++; showQ(); }, 1100);
      });
      optsEl.appendChild(btn);
    });
  }
  showQ();
}

function showB1List() {
  document.getElementById('b1-topic-list').style.display = 'block';
  document.getElementById('b1-detail').style.display     = 'none';
  initB1Screen();
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   SETTINGS
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function initSettingsScreen() {
  const longest = loadData('longestStreak', 1);
  document.getElementById('settings-longest').textContent = longest;
  const dir = loadData('quizDirection', 'ES_TO_EN');
  document.getElementById('direction-toggle').checked = dir === 'EN_TO_ES';
  document.getElementById('direction-label').textContent = dir === 'ES_TO_EN' ? 'Spanish â†’ English' : 'English â†’ Spanish';
  initDarkMode();
  renderScoreGraph();
}

function toggleDirection(checked) {
  const dir = checked ? 'EN_TO_ES' : 'ES_TO_EN';
  saveData('quizDirection', dir);
  document.getElementById('direction-label').textContent = dir === 'ES_TO_EN' ? 'Spanish â†’ English' : 'English â†’ Spanish';
  showToast(dir === 'ES_TO_EN' ? 'ğŸ”„ Spanish â†’ English' : 'ğŸ”„ English â†’ Spanish');
}

function toggleDarkMode(enabled) {
  saveData('darkMode', enabled);
  document.body.classList.toggle('dark-mode', enabled);
}

function initDarkMode() {
  const dark   = loadData('darkMode', false);
  document.body.classList.toggle('dark-mode', dark);
  const toggle = document.getElementById('dark-mode-toggle');
  if (toggle) toggle.checked = dark;
}

function renderScoreGraph() {
  const scores = loadData('quizScores', []);
  const canvas = document.getElementById('score-canvas');
  const empty  = document.getElementById('score-graph-empty');
  if (!canvas) return;

  if (scores.length === 0) {
    canvas.style.display = 'none';
    if (empty) empty.style.display = 'block';
    return;
  }
  canvas.style.display = 'block';
  if (empty) empty.style.display = 'none';

  // Wait for layout to settle
  requestAnimationFrame(() => {
    const ctx    = canvas.getContext('2d');
    const w      = canvas.width  = canvas.offsetWidth || 300;
    const h      = canvas.height = 120;
    ctx.clearRect(0, 0, w, h);

    const recent = scores.slice(-10);
    const gap    = (w - 20) / recent.length;
    const barW   = Math.min(32, gap - 6);

    recent.forEach((score, i) => {
      const barH = (score / 5) * (h - 28);
      const x    = 10 + i * gap + (gap - barW) / 2;
      const y    = h - barH - 20;
      ctx.fillStyle = score === 5 ? '#4ADE80' : score >= 3 ? '#FBBF24' : '#F87171';
      ctx.beginPath();
      if (ctx.roundRect) { ctx.roundRect(x, y, barW, barH, 4); }
      else { ctx.rect(x, y, barW, barH); }
      ctx.fill();
      ctx.fillStyle = '#64748B';
      ctx.font = '10px Nunito, sans-serif';
      ctx.textAlign = 'center';
      ctx.fillText(score + '/5', x + barW / 2, h - 4);
    });
  });
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   SUPPORT BANNER
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function initSupportBanner() {
  const dismissed = loadData('supportBannerDismissed', false);
  const banner    = document.getElementById('support-banner');
  if (banner) banner.style.display = dismissed ? 'none' : 'flex';
}

function dismissSupportBanner() {
  saveData('supportBannerDismissed', true);
  const banner = document.getElementById('support-banner');
  if (banner) banner.style.display = 'none';
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   TOAST
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
let toastTimer;
function showToast(message) {
  const el = document.getElementById('toast');
  el.textContent = message;
  el.classList.add('show');
  clearTimeout(toastTimer);
  toastTimer = setTimeout(() => el.classList.remove('show'), 2000);
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   INIT
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
(function init() {
  initDarkMode();
  initB1Screen();
  refreshHome();

  // Load initial lesson
  const day = loadData('currentDay', 0);
  loadLesson(day);
})();
</script>
</body>
</html>
